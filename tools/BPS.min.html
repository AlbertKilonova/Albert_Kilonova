<!DOCTYPE html><html><head><meta charset="UTF-8"><title>卡帧工具</title><style>body{font-family:Arial;max-width:800px;margin:20px auto;padding:20px;background:#f0f2f5}.box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 10px #0000001a}input{padding:8px;margin:5px;width:100px;border:1px solid #ddd}button{background:#007bff;color:#fff;border:0;padding:8px 15px;border-radius:5px;cursor:pointer}.res{margin-top:15px;padding:15px;background:#f8f9fa}@keyframes a{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.loading{display:inline-block;width:18px;height:18px;border:2px solid #0000;border-top:2px solid #007bff;border-radius:50%;animation:b 1s linear infinite}@keyframes b{to{transform:rotate(360deg)}}</style></head><body><div class="box"><h2>卡点计算器</h2><div>音乐时长：<input id="m" placeholder="分" type="number"><input id="s" placeholder="秒" type="number"></div><div>BPM：<input id="b" value="140" type="number"></div><div>FPS：<input id="f" value="60" type="number"></div><button onclick="c()">计算</button><div id="r" class="res"></div></div><script>let d={};function e(t,n){let o=[];for(let e=0;e<=t;e++){let a=e/n,i=Math.floor(a/3600),r=Math.floor(a%3600/60),s=Math.floor(a%60),l=e%n;o.push({f:e,t:`${i.toString().padStart(2,0)}:${r.toString().padStart(2,0)}:${s.toString().padStart(2,0)}:${l.toString().padStart(2,0)}`})}return o}function p(){let t=JSON.stringify({meta:d.m,pattern:d.p,error:d.e,time:d.t},null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`data_${Date.now()}.json`,a.click()}function v(){let t="Frame,Timecode\n";d.t.forEach(n=>{t+=`${n.f},${n.t}\n`}),n=new Blob([t],{type:"text/csv"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`time_${Date.now()}.csv`,a.click()}function g(t,o=20){let a=Math.floor(t),i=Math.ceil(t);if(a===i)return{x:1,y:0};let r=i-t,l={x:0,y:0,e:1/0};for(let n=1;n<=o;n++){let e=Math.round((1-r)*n),s=n-e;if(e>=0&&s>=0){let o=(i*e+a*s)/(e+s),c=Math.abs(o-t);c<l.e&&(l={x:e,y:s,e:c})}}return l}function c(){let t=+(document.getElementById("m").value||0)*60+(+document.getElementById("s").value||0),o=+document.getElementById("b").value,n=+document.getElementById("f").value,a=t*(o/60),i=(1/(o/60))*n,{x:r,y:s,e:l}=g(i),h=Math.ceil(i),u=Math.floor(i),m=r+s,b=Math.floor(a/m),k=a%m,w=l/n,C=w*a,y=e(Math.round(t*n),n);d={m:{bpm:o,fps:n,dur:t,beat:a},p:{high:h,low:u,hc:r,lc:s},e:{per:w,total:C},t:y},document.getElementById("r").innerHTML=`<h3>结果</h3><p>总拍数：${a.toFixed(1)}拍 | 理论帧/拍：${i.toFixed(3)}</p><p>方案：${h}帧×${r}+${u}帧×${s} [周期${m}拍]</p><p>误差：±${w.toFixed(4)}s/拍 | 累计：${C.toFixed(2)}s</p><p>时间码：${y.length}帧</p>`}</script></body></html>